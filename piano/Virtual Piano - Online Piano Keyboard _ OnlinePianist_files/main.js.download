//vr 3.3
/*global $, jQuery, smoothScroll, console, alert*/

var mixpanel = {
  track : function() {
    return true;
  }
};   
function MainModalShow(trigger) {
    "use strict";
	var action;
	
    $("html, body").animate({ scrollTop: 0 }, "slow");
    
    
    $('.header-upper-sign, .header-upper-login').addClass('hide-js');
    $('.header-upper').removeClass('stick');
    $('#gap-creator-2,#gap-creator-3').hide();
    $('#indexModal').slideDown(300);
   
    $('#gap-creator').show(300);
	$("input,.user-logo,.password-key").show();
    $('.sign-up').html("Send");
    
	if (trigger === 'login') {
		$('.modal-signup,.modal-password,input[name=name],.user-logo').hide();
		$('.modal-content').addClass('modal-content-login').removeClass('modal-forgotten');
		action = "/auth/login";
         $('.sign-up').html("Sign in");
	} else if (trigger === 'signup') {
		$('.modal-login,.modal-password').hide();
		$('.modal-content').removeClass('modal-content-login modal-forgotten');
		action = "/auth/register";
        $('.sign-up').html("Sign up");
	} else { // password reset
        trigger = 'password';
        action = "/password/email";
		$("input[name=password],input[name=name],.user-logo,.password-key,.modal-signup,.modal-login").hide();
		$('.modal-content').addClass('modal-content-login').addClass('modal-forgotten');
        $('.sign-up').html("Reset Password");
	}
    
    

	$('#form-iden').val(trigger);

	$('.modal-' + trigger).fadeIn(500);
	$("#modal-form").attr("action", action);

}

function getSetHeight() {
    modalHeight = $('#indexModal').outerHeight();
    $('#gap-creator').css('height',modalHeight+'px');

}
	


function isMobile () {
  var check = false;
  (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))check = true})(navigator.userAgent||navigator.vendor||window.opera);
  return check;
}



$(document).ready(function () {
    $('a[href*="#"]:not([href="#"])').click(function() {
      if (location.pathname.replace(/^\//,'') == this.pathname.replace(/^\//,'') && location.hostname == this.hostname) {
        var target = $(this.hash);
        target = target.length ? target : $('[name=' + this.hash.slice(1) +']');
        if (target.length) {
          $('html, body').animate({
            scrollTop: target.offset().top
          }, 700);
          return false;
        }
      }
    });
  });

$(document).ready(function () {
    
	"use strict";
	var token = $("input[name*='_token']").val(), pagePos = 1, sortby = 'added', searchMenu = $('.search-dropdown'), lastInput, songs_id = [], songs_names = [], ajaxCompleteFav = 1, ajaxCompleteComp = 1,  removeMenu = 0, request = false, timer,bsToken;

    //smoothScroll.init({speed: 1000, easing: 'easeInOutCubic'});
	
    $('[data-toggle="tooltip"]').tooltip(); 


   $(window).scroll(function() {

        if ($(this).scrollTop()>0){
            $('.general-msg#is_guest').hide();  
        } else {
            $('.general-msg#is_guest').show();
        }
    });
    
    $('.general-msg .close').click(function () {
       $.ajax({
	        url: "/action/strip/dismiss/browser",
            headers: {'X-CSRF-TOKEN': token},
	        type: 'POST'
		});
    });
    //delete after holidays
    $('#holidays-msg .close').click(function () {
       $.ajax({
	        url: "/action/strip/dismiss/holidays",
            headers: {'X-CSRF-TOKEN': token},
	        type: 'POST'
		});
    });
    
    $('#activate-msg .close').click(function () {
       $.ajax({
	        url: "/action/strip/dismiss/verfication",
            headers: {'X-CSRF-TOKEN': token},
	        type: 'POST'
		});
    });
    
        
    $('#premium-expired .dismiss').click(function () {
     $.ajax({
	        url: "/user/popup/expired/confirm",
            headers: {'X-CSRF-TOKEN': token},
	        type: 'POST'
		});
    });
    
    // favorite function
    $(document).on('click',	'.fav-trigger,.fav-trigger-se', function (event) {
     
        event.preventDefault();
        var tthis = $(this), splitId, action = 'add', status = 'remove',msg = 'Added to Songbook!',playermsg='Remove from Songbook';
        var offset = tthis.offset();
        
        clearTimeout(timer);

        
        if (ajaxCompleteFav) {

            $('.fav-confirm-msg').hide();

            splitId = $(this).attr("id").split('_');

            if ($(this).children('img').length > 0 && $(this).children('img').attr("src").indexOf("remove") !== -1) {
                action = 'remove';
                status = 'add';
                msg = 'Removed from Songbook!'
                
                
            }
            
            // for player
            if ($('#markersElement .fav-trigger').length > 0 && $('#markersElement .fav-trigger').attr("src").indexOf("remove") !== -1) {
                action = 'remove';
                status = 'add';
                msg = 'Removed from Songbook!'
            }

            if ($('.song-end-ember .fav-trigger-se img').length > 0 && $('.song-end-ember .fav-trigger-se img').attr("src").indexOf("remove") !== -1) {
                action = 'remove';
                status = 'add';
                msg = 'Removed from Songbook!'
                playermsg = 'Add to Songbook';
            }
 
            //
            
            $(this).children('img').attr('src', 'https://assets.onlinepianist.com/assets/images/' + status + '_songbook.png');
            $('#markersElement img.fav-trigger').attr('src', 'https://assets.onlinepianist.com/assets/images/player/' + status + '-songbook.png');
            $('.song-end-ember .fav-trigger-se img').attr('src', 'https://assets.onlinepianist.com/assets/images/player/' + status + '_songbook_white.png');
            $('.song-end-ember .fav-trigger-se span').text(playermsg);
            
            
            
            $('.fav-confirm-msg').css({"top": offset.top, "left": offset.left}).html(msg).delay(500).show(300);
            timer = setTimeout(function () { $('.fav-confirm-msg').hide(200); $('#playerMsgAboveDemo').remove();
 }, 2000);
            
            ajaxCompleteFav = 0;
            $.ajax({
                url: "/mysongbook/" + action,
                data: 'songid=' + splitId[1],
                headers: {'X-CSRF-TOKEN': token},
                type: 'POST'
            }).done(function () {

                    
            }).always(function () {
                ajaxCompleteFav = 1;
            });
        }
            
    });
    
	//terms
    $('.legal-menu-mobile').on('click', function () {
       $(this).find('.glyphicon').toggle();
       $('div.' + $(this).data('terms-click')).toggle();
	});
	//
	
	// songbook quickview
	$('#songbook-quick-trigger').click(function () {
		$('#songbook-quick').slideToggle();
	});
	
	//user settings
    
    
    $('.switch').submit(function (event) {
        event.preventDefault();
        var str = $(this).attr("id");
        var exploded = str.split('-');
        var r = confirm('Your ' + exploded[1] + ' subscription will start once your current ' + exploded[0] + ' period is over.');
        if (r == true) {
            this.submit();  
        }
    });    
    
    
	$('#user-settings').submit(function (event) {
		event.preventDefault();
		var tthis = this, Input = $.trim($('input[name=name]').val()), Field = $(this).attr("name");
		$(tthis).find('button').html('Saving...');
		$.ajax({ url: "/user/settings?input=" + Input + "&field=" + Field, headers: {'X-CSRF-TOKEN': token},
		    type: 'POST'
		    }).done(function (data) {
			$(tthis).find('button').html('Saved!').show();
			
			setTimeout(function () { $('#user-settings').find('button').html('Save Changes'); }, 3000);
		});
		
	});

	$('.auth-change').submit(function (event) {

		event.preventDefault();
		var form = this, url = '/user/password/validate', input = 'currentpassword=' + $(this).find('input[name=currentpassword]').val();
	
        $(this).find('.error-container').empty();
        
		if ($(this).attr("id") === 'pswd-change') {
			if ($('input[name=newpassword]').val() !== $('input[name=verifypassword]').val() || $('input[name=newpassword]').val() === '') {
				$(this).find('.error-container').html('<div class="alert alert-danger">- New password do not match</div>');
				return false;
			}
		} else if ($(this).attr("id") === 'email-change') {
           
            if ($('input[name=newmail]').val() === '') {
                $(this).find('.error-container').html('<div class="alert alert-danger">- Enter valid email</div>');
                return false;
			}
        }
			
			
		$.ajax({ url: url, headers: {'X-CSRF-TOKEN': token},
		    type: 'POST',
		    data: input
		    }).done(function (data) {
            console.log(data);
			if (data == 1) {
				form.submit();
            } else {
				$(form).find('.error-container').html('<div class="alert alert-danger">- Current password is incorrect</div>');
            }
        });
            
	});
    
    
    $('.remove-account').on('click', function (event) {
        event.preventDefault();
        var r = confirm('You will lose access to your account and your songbook will be deleted, Are you sure?');
        if (r == true) {
            window.location = this.href;
        } 
       
    });    
    
    $('.cancel_trial').on('click', function(event) {
        event.preventDefault();
        $('#trial-sub-cancel').modal(); 
    });
    $('.subscription-renewal .cancel_recurring').on('click', function(event) {
        event.preventDefault();
        $('#contract-switch-confirm').modal(); 
    });
    
    
    $('#contract-switch-confirm button,#trial-sub-cancel button').click(function (event) {
              
        if ($(this).attr('class')=='true') {
            $.ajax({ url: "user/cancel/recurring", headers: {'X-CSRF-TOKEN': token},type: 'POST'})
            .done(function (data) { location.reload(); })
        } else {
            $('.subscription-renewal .default').prop('checked', true);
            $('.subscription-renewal .trigger').prop('checked', false);
        }
        
    });   
    
    
    
	//mobile nav
	$('h3').on('click', function () {
		
		if ($(this).hasClass('active')) {
			$(this).removeClass('active');
			$('.user-settings-form.active').slideUp().removeClass('active');
	
			return false;
		}
		$('h3.active').removeClass('active');
		$(this).addClass('active');
		$('.user-settings-form.active').slideUp().removeClass('active');
		$(this).parent().find('.user-settings-form').slideDown().addClass('active');
	});
	//
	
    
	
	//homepage modal video
	$('#app-preview-video').on('show.bs.modal', function (event) {
        
        var width = ($('body').width()/2)*0.9,height,videoElement = document.getElementById('videoId');
        height = (width * 0.5625);

        videoElement.height = height;
        videoElement.width = width;
        videoElement.play();
        if (isMobile()===true) {
            videoElement.webkitRequestFullScreen();
        }
        
        $('#app-preview-video .modal-dialog').width(width*1.06);
    });
    
    
	$('#app-preview-video').on('hide.bs.modal', function (event) {
        var videoElement = document.getElementById('videoId');    
        videoElement.pause();
	    //$(this).find('.modal-body').html('');
	});
    
    $("#videoId").bind("ended", function() {
        var videoElement = document.getElementById('videoId');    
        if (isMobile()===true) {
            videoElement.webkitExitFullscreen();
        }
        $('#app-preview-video').modal('hide');
    });  
        
	

    /// click mobile tracking
        
    $('.store-click-event').on('click', function (event) {
        console.log("in");
        var str = $(this).attr('href');
        var n = str.indexOf("https://itunes.apple.com");
        if (n >= 0)
            gtag('event', 'ios-store-click', {'event_category': 'store-clicked'});
        else
            gtag('event', 'android-store-click', {'event_category': 'store-clicked'});
        
    });    
    
    
    
	///////////////////////////////////////////// SEARCH
	function checkScreenWidth() {
        
        
        if ($(window).width() <= 1024) {
            
            $('#art-fav').insertBefore($('.stack'));
            $('#art-recent').insertAfter($('.stack'));
            
        } else {
            $('#art-recent').insertBefore($('.stack'));
            $('#art-fav').insertAfter($('.stack'));
        }
        
        
		if ($(window).width() < 600) {
			searchMenu.addClass('mobile');
			//$('.header-upper').append(searchMenu);
		} else {
            //flag = false;
            searchMenu.removeClass('mobile');
        }
        
        $('#search-form').hide();
        $('#search-img').show();
        $('#search-form-mobile').hide();
        $('#gap-creator').css('height',$('#indexModal').height());
        
	}
	checkScreenWidth();
	$(window).resize(function () { 
        if (isMobile()===false) {
            checkScreenWidth(); 
        }
    });
    
    
    $('#search-form').submit(function (e) {
        event.preventDefault();
    });

    $('.search-button-image button, .favorite-artist button').on('click', function () {
    
        searchMenu.hide();
        $('#search-form input, #guest-search').val('');
        $('#search-form,#search-form-mobile').hide();
        $('#search-img').show();
        $('#songbook-quick-trigger').show();
        
         $('.search-button-image button .spirite_search, .favorite-artist button .spirite_search').show();
        $('.search-button-image button > img, .favorite-artist button > img').remove();
  
     });   
    
    

        
	$('#search-img').on('click', function () {

        $(this).hide();
        
        
        
        if ($(window).width() < 600) {
            $('#search-form-mobile').show();
            //$('#search-form-mobile input').focus(); 
            
        } else {
          
	        $('#songbook-quick-trigger').hide();
            $('#search-form').removeClass('visible-lg visible-md').show();
            $('#search-form input').focus();
        }
        $('.search-button-image button .spirite_search').hide();
        
        if($('.search-button-image button img').length == 0){
            $(".search-button-image button").append("<img src='/images/close-search.png' style='display:inline-block;'/>");
        }

  
	});
	
    
    var filterCandidates = function(currentInput){
    //Previous request needs to be aborted.
            
    request = $.ajax({
                    url: "/search",
                    headers: {'X-CSRF-TOKEN': token},
                    data: "input=" + currentInput,
                    type: 'POST'
                }).done(function (data) {
                    $("#search-loader").hide();
                    $("#search-result").html(data);
                    searchMenu.show();
                    mixpanel.track("main_search",{"searchKeyword": currentInput});

                });

    return request;
    };
    
    	 
    $('#search-form input, #search-form-mobile input, #guest-search').keyup(function () {

        var currentInput = $.trim($(this).val());

        
        
        if ($(this).attr('id')=='guest-search') {
            var offsetSearch = $(this).position();
            $(".search-dropdown").css("top", offsetSearch.top).css("left", offsetSearch.left);

        } else {
                $(".search-dropdown").removeAttr('style');
        }
        
        
        searchMenu.removeClass('guest-search');
        
   
        if($('.search-button-image button img').length == 0){
            $('.search-button-image button .spirite_search, .favorite-artist button .spirite_search').hide();
            $(".search-button-image button, .favorite-artist button").append("<img src='/images/close-search.png' style='display:inline-block;'/>");   
        }
        
        $("#search-result").empty();
        
        if(request && request.readyState !== 4){
            request.abort();
        }
        
        if (currentInput.length < 2) {
              searchMenu.hide();
        } else if (currentInput.length > 1 ) {
            searchMenu.show();
            $("#search-loader").show();

            request = filterCandidates(currentInput);

            lastInput = currentInput;

        }

    });
    
    $('#search-form input, #search-form-mobile input, #guest-search').click(function () {

       
        if ($('#search-result').contents().length > 0)
            searchMenu.show();
    });   
         
    
    
    
	//////////////////

    
    
    $("ul.dropdown-menu li").click(function (e) {
        mixpanel.track("MM_itemClick",  {"menuItemName": $(this).text()});
    });
    
    
    // HAMBURGER
    $(".dropdown-menu").on("show.bs.dropdown", function(event){
        mixpanel.track("MM_openMenu");
        searchMenu.hide();
    });
	//
    
    ///////payments page

    if($('#PaymentPopup').length || $('#paymentModal').length ){
        
        var path = $(location).attr('href');
        
        if (path.indexOf("premium") < 0) {


                    


                $('#PaymentPopup .modal-body').load('/payment/modal/body', function() {
                    $('#PaymentPopup .modal-body p').show();
                });

        } else {
            console.log('is premium page');

        }
       
    }
    

    

    
    
    top.payemntClickSource = 'storeClick';
   	$('#PaymentPopup').on('show.bs.modal', function (e) {

        if (bsToken==null ) {
            $.get("/payment/get/token", function( data ) {

                bsToken = data;

            $.getScript('https://ws.bluesnap.com/source/web-sdk/bluesnap.js', function() {

                $.getScript('/js/vendor/bluesnap.js', function() {

                    $('#paymentModal').load('/payment/modal', function() {
                        $('.cta-loading').hide();
                        $('.cta').show();
                        $('#bs-hidden-token').val(bsToken);
                        $(this).children(':first').unwrap();

                    });
                 });

            });



            });
     }
        
        var triggerClass = $(e.relatedTarget).attr("class");

        if (typeof triggerClass !== 'undefined' && triggerClass.search("player") >= 0)
            top.payemntClickSource = 'playerAddClick';
        
        $.ajax({ url: "/user/event/payment-popupview", headers: {'X-CSRF-TOKEN': token},
                type: 'POST'
        });  
        
        localStorage.setItem("payment_start_from",  top.payemntClickSource);
        mixpanel.track("PP_popOpen",{"ppSource": top.payemntClickSource});
        
        
    });
    

    
    //thank you (mysongbook)
    $('#after-payment-thankyou').on('hidden.bs.modal', function () {
        $("#songModal").modal();
    });
    
	
	 $(document.body).on('click', '.pay-credit, .pay-paypal' ,function(){
		$('.credit-type, .paypal-type').hide();
		var str = $(this).attr('class'), res = str.split('-');
		$('.' + res[1] + '-type').show();
    });
    

    var activeClickOnPlan = 0;
    

    
    $(document.body).on('click', '.payment-page' ,function(){

       
        var amount = $(this).attr("data-price"), title = $(this).attr("id"), currency = $('.currency').attr("value"), currency2 = $('.currency2').attr("value"), displayonlytitle,  subtitle = $(this).attr("data-title"), subtitle2 = $(this).attr("data-subtitle");
   
        activeClickOnPlan = 1;
        
        if (subtitle == 'YearlyR') {
            displayonlytitle = 'Yearly';
        } else {
           displayonlytitle = subtitle;
        }
        
       
        mixpanel.track("PP_planClicked",{"ppPlan": title, "ppSource": payemntClickSource});

        
        $('#paymentModal .small-amount').html(currency2+amount + " " + displayonlytitle);
        $('.currency-string').html(currency);
        $('#currency').val(currency);
        $('#user_amount').val(amount);
        
        var ttt = displayonlytitle.replace('every ','');
        
        if (title == 'Yearly' || title == 'Yearly20off') {
            $('#paymentModal .myModalLabel, #paymentModal #title').html('Yearly Subscription with 7 Days Free Trial');
             $('.yearly-explain').show();
        }else if (title == 'yearlyTrial1') {
            $('#paymentModal .myModalLabel, #paymentModal #title').html('Yearly Subscription with 24 Hours Free Trial');
             $('.yearly-explain2').show();
        } else {
            $('.yearly-explain,.yearly-explain2').hide();
            $('#paymentModal .myModalLabel, #paymentModal #title').html(ttt + ' Subscription Purchase');
        }
   
        
                    
        if (subtitle2!='')
            $('#paymentModal .amount').html(subtitle2);
        else
            $('#paymentModal .amount').html(currency2+' '+amount);
        
		
   
        $('#pack_iden').val(title);
        
      	
        $("#PaymentPopup").modal("hide");
        //$("#paymentModal").modal("show");
        //$('body').addClass('modal-open');
        
        
        

        $.ajax({ url: "/user/event/payment-details-popupview", headers: {'X-CSRF-TOKEN': token},
            type: 'POST'
        }); 

	
    });
  
     $(document.body).on('hidden.bs.modal', '#PaymentPopup', function (event) {
        if (activeClickOnPlan)
            $("#paymentModal").modal("show");	
        

    });

    $(document.body).on('hidden.bs.modal', '#paymentModal', function (event) {
        activeClickOnPlan = 0;
        $("#PaymentPopup").modal("show");	
    });
    
    
    
	$(document.body).on('click', '#paypalButton' ,function(){
		var amount = $('#user_amount').attr("value"), title = $('#pack_iden').attr("value"), currency = $('#currency').attr("value");
        
            $('#loader-paypal').show();
            $(this).hide();
			$.ajax({ url: "/payments/paypal/create-payment?amount=" + amount + "&currency=" + currency + "&title=" + title, headers: {'X-CSRF-TOKEN': token},
		    type: 'POST'
		      }).done(function (data) {  window.location.href = data; });
	});
    
   	$(document.body).on('change',  "#country" ,function(){
	
		$( ".state, .province").hide();
		
		if ($(this).val() == 'us')
			$( ".state").show();
		else if ($(this).val() == 'ca')
			$( ".province").show();
	});	

    
    $(document.body).on("submit", "#checkout-form", function(e){
        e.preventDefault();
    });	
    

    
    //bluesnap
    
    window.checkOPfields = function(e) {
        
      
        var errorCount = 0;
        
        $('#checkout-form').find("input:visible, select:visible").each(function (index) {
			if ($(this).val() == '' ||  $(this).val() == null) {
                errorCount += 1;	
                $('#errorBlock .error-container').prepend('<div class="alert-danger">Please enter valid '+$(this).siblings('label').text().toLowerCase()+'</div>');
                
            }   
		});
        
         if (errorCount) 
            return false;

        return true;
    }
    
    
    window.dobluesnap = function() {

         var data = $('#checkout-form').serialize(), i,  errorCount = 0;
        
        $('.error-container').empty();
        $("input[type='submit']").hide();
        $("#formloader").show();
        

        if (checkOPfields() == true) {
            
             $.ajax({ url: "/premium/checkout/bluesnap", headers: {'X-CSRF-TOKEN': token},
                data: data,
                type: 'POST'
            }).done(function (data) {
                if (data === '') {
                    window.location.href = "/mysongbook";
                }
                else {
                    $(".modal").animate({ scrollTop: 0 }, "slow");
                    $('.error-container').html('<div class="alert alert-danger">'+data+'</div>');
                    $("input[type='submit']").show();
                    $("#formloader").hide();
                } 
           });
        }
        
    }

/////////////

    
    
//// main modal 

	$('#modal-form, #user-settings-pwd').submit(function (event) {

		event.preventDefault();
		var errorCount = 0;
		$("#modal-form input:visible, #user-settings-pwd input:visible" ).not(".coupon").each(function (index) {
			if ($(this).val() === '') {
                errorCount = errorCount + 1;
            }
		});
		
		if (!errorCount) {
			this.submit();
        } else {
		    $(this).find('.error-container').html('<div class="alert alert-danger">All field are required.</div>');
        }
        
        
        $('#gap-creator').css('height',$('#indexModal').height());

	});

	
    $('#indexModal .close').click(function () {
        $('#indexModal,#gap-creator').hide();
        $('.header-upper-sign, .header-upper-login').removeClass('hide-js');

        $('.header-upper').addClass('stick');
        $('#gap-creator-2, #gap-creator-3').show();
    });    
    
    
    $('.open-signup,.open-login,.f-password').click(function (event) {
        event.preventDefault();
       
   
		var classname = $(this).attr('class'), triggername = classname.split('-'),modalHeight
		$('.error-container').empty();
        $('.modal-login, .modal-password').hide();
        $('.open-coupon').show();
        $('.coupon').addClass('hide');

        MainModalShow(triggername[1]);
            
        
        setTimeout(getSetHeight, 300)



	});
    
         
    $('.open-coupon').click(function (event) {
        $(this).hide();
        $('.coupon').removeClass('hide');
       
    });
    

	
	
	//// mysongbook quickview
    $('.ftrigger').click(function () {
        $('#favorite,#recently').hide();
        $($(this).attr('data-parent')).fadeToggle("slow", "linear");
        $('.ftrigger').css('font-weight', 'normal');
        $(this).css('font-weight', 'bold');
    });
	//

    
    
        
    // songbook mobile 
    $(document).on('click',	'.dots-add-remove', function (e) {

        e.preventDefault();

        if (!removeMenu) {
        $('.remove-add').removeClass('active').addClass('not-active');
        $(this).next().addClass('active'); //open remove & complete
            removeMenu = 1;
        } else {
            $('.remove-add').removeClass('active');
            $('.remove-add').addClass('not-active'); 
            removeMenu = 0;
        }
        
    });
        
    
    $(document).bind('click', function(e) {
        var bindParent;
        if(!$(e.target).is('.recommended-dots')) {
            if (removeMenu) {
            $('.remove-add').removeClass('active');
            $('.remove-add').addClass('not-active'); 
            removeMenu = 0;
            }
        } else if ((!$(e.target).is('.search-dropdown mobile'))) {
            $('.search-dropdown mobile').hide();
        }
        
        bindParent = $(e.target).parents('div.search-dropdown');
    
        if(!bindParent.is('.search-dropdown') && !$(bindParent.context).is('.search-dropdown, input.input-mobile, input.search') && $(window).width() < 1025) {
            $('div.search-dropdown').hide();
        }

    
    });
    //
    
    
    
	////songbook

    function removeSongSongbook (songid) {
        
        $('#'+songid+', #'+songid+'-m').parent().hide(200);
        
 

            $.ajax({
                url: "/mysongbook/remove",
                data: 'songid=' + songid + '&page=' + pagePos + '&iden=refresh&sortby=' + sortby,
                headers: {'X-CSRF-TOKEN': token},
                type: 'POST'
            }).done(function (data) {       
                $("#list-view .ajax-wrapper").html(data[0]);
                $("#grid-view").html(data[1]);

            });


  
    
    }
    
    
    $('.logout-event').click(function (event) {
            mixpanel.track("logout");
    }); 
    
    $('.right-nav,.left-nav').click(function (event) {
        var curerntNumber = $('.whats-new .number').text();
        
        if ( $(this).attr('class') == 'right-nav')
            curerntNumber++;
        else
            curerntNumber--;
        
        if (curerntNumber > 3)
            curerntNumber = 1;
        if (curerntNumber < 1)
            curerntNumber = 3;
        
        $('.text,.img1,.img2,.img3').hide();
        $('.whats-new .number').text(curerntNumber);
        $('#text'+curerntNumber).fadeIn(200);
        $('.img'+curerntNumber).fadeIn(300);
    }); 
    
    $(document).on('click',	'.del-trigger-full', function (event) {
        event.preventDefault();
        var splitId = $(this).attr("id").split('-m');
       $('#remove-confirm-modal input').val(splitId[0]);
       $('#remove-confirm-modal').modal();
    });
    
       
    $(document).on('click',	'.del-trigger', function (event) {
        event.preventDefault();
        var splitId = $(this).attr("id").split('-m');
        var songName = $(this).attr("title");
        mixpanel.track("SB_Edit_RemoveSong",{"songName": songName, "songid": splitId[0]});
        
        removeSongSongbook(splitId[0]);
        
        
    }); 
    
    
    
    
    $('#remove-confirm-modal .remove-button').click(function (event) {
        var songid =  $('#remove-confirm-modal input').attr("value");
        removeSongSongbook(songid);
        
    });
    
    $(document).on('click',	'.complete-trigger', function (event) {
        event.preventDefault();
        var tthis = $(this), splitId, action = 'check', status = 'v';

        
        if (ajaxCompleteComp) {

        
            splitId = $(this).attr("id").split('_');

            if ($(this).children('img').attr("src").indexOf("empty") === -1) {
                action = 'uncheck';
                status = 'v-empty';
            }

            tthis.children('img').attr('src', '/images/' + status + '.png');
            ajaxCompleteComp = 0;
            $.ajax({
                url: "/mysongbook/" + action,
                data: 'songid=' + splitId[0],
                headers: {'X-CSRF-TOKEN': token},
                type: 'POST'
            }).always(function () {
                ajaxCompleteComp = 1;
            });
        }
            
        
        

    });
    
    
    $('#songModal').on('hidden.bs.modal', function (event) {
        $("#favoriteMoreSongs").modal();
	});
	$('#songModal').on('show.bs.modal', function (event) {
		setTimeout(function(){
			mixpanel.track("FU_3songsPop");
		}, 2000);
		
	});

    $('#fav-dismiss').click(function () {
		
        $.ajax({
	        url: "/mysongbook/popup/fav/confirm",
            headers: {'X-CSRF-TOKEN': token},
	        type: 'POST'
		});
	});
    
    $('#WelcomeBackDismiss').click(function () {
		
        $.ajax({
	        url: "/mysongbook/popup/welcome-back/confirm",
            headers: {'X-CSRF-TOKEN': token},
	        type: 'POST'
		});
	});
  
    $('.popup-item').click(function () {
        var selector = $(this).children("a"), id = selector.attr("id"), name = selector.attr("title"), index;
        //remove
        if (songs_id.indexOf(id) !== -1) {
            index = songs_id.indexOf(id);
            songs_id.splice(index, 1);
            songs_names.splice(index, 1);
            $(this).removeClass('active');
        // limit    
        } else if (songs_id.length >= 3) {
            alert("You can only choose 3 Songs.");
            return false;
        //add
        } else {
            songs_id.push(id);
            songs_names.push(name);
            $(this).addClass('active');
        }
       
        $('#selection-data').val(songs_id);
        $('#submit-count').html(3 - songs_id.length);
        
      
    });
    
    
    $('#submit-popup').click(function () {
        
        if (songs_id.length !== 3) {
            alert("Please choose 3 Songs...");
        } else {
            mixpanel.track("FU_3songsPop_addSongs",{"songsName": songs_names.join(), "songsId": songs_id.join()});
            $("#popup-form").submit();
        }
        
    });
    
    $('#more-result').click(function () {
		pagePos = pagePos + 1;
		$.ajax({ url: "/mysongbook/ajax?page=" + pagePos + "&iden=more&sortby=" + sortby, headers: {'X-CSRF-TOKEN': token},
            type: 'GET'
            }).done(function (data) {
			
			if (data[0] === '') {
				pagePos = pagePos - 1;
			} else {
                if (data[2] <  12)
                    $('#more-result').fadeOut(300);
            
				$("#list-view .ajax-wrapper").append(data[0]);
				$("#grid-view").append(data[1]);
			}
		});
    });
	 
    $('.purchases-tab,.fav-tab').click(function () {
        
        $('.header-tabs ul li').removeClass('active');
        $(this).addClass('active');
        if ($(this).attr('class') == 'purchases-tab active') {
            $('.sheets-purchases').show();
            $('.container-tablet-bigger').hide();
        } else {
            $('.container-tablet-bigger').show();
            $('.sheets-purchases').hide();
        }
     });
  
    $('.dropdown-toggle-songbook').click(function (e) {
        mixpanel.track("SB_sort");
    });
    

    $('.song-click').click(function (e) {
        var res = $(this).attr("data-clickinfo").split(",");
        mixpanel.track("SB_songClick",{"songName": res[0], "songId": res[1], "category": res[2] });
    });
    
    $('#songbook-dropdown li a').click(function (e) {
        e.preventDefault();
        var sorttext = $(this).text();
		sortby = $(this).attr("title"),
		
        mixpanel.track("SB_sort_Order",{"orderType": sortby});
        
		$(this).html($("#dropdownMenu1 span:first").text()); // text value of selection
		$(this).attr('title', $("#dropdownMenu1 span:first").attr('title')); // id of selection

		
		$.ajax({ url: "/mysongbook/ajax?page=" + pagePos + "&sortby=" + sortby + "&iden=sort", headers: {'X-CSRF-TOKEN': token},
		      type: 'GET'
		    }).done(function (data) {
		
            $("#list-view .ajax-wrapper").html(data[0]);
            $("#grid-view").html(data[1]);
            $("#dropdownMenu1 span:first").html(sorttext).attr('title',sortby) ;
			
		});
    });
	//
	
	$(document).on('click',	'#grid,#list,#gridI,#listI', function () {
        var section ='piano-songs';
        var idd = $(this).attr('id');
        
        if (idd == 'gridI' || idd == 'listI')
            section ='mysongbook';

    
		
        $('#list-view,#grid-view').toggleClass('hide');
        $('#grid,#list,#gridI,#listI').toggleClass('not-active');

        
        $.ajax({
	        url: "/"+section+"/ajax/save",
            headers: {'X-CSRF-TOKEN': token},
            data: "view=" + idd,
	        type: 'POST'
		})
	});

	
	$(document).on('click', '#index-dropdown li a', function (e) {
        e.preventDefault();
	    var sortby = $(this).attr("title"), view = $("#_curentview").text();
        var pageNum = $("#_curentpage").text();
	    $.ajax({
	        url: "/piano-songs/" + view + "?page=" + pageNum,
            headers: {'X-CSRF-TOKEN': token},
            data: "sortby=" + sortby + "&cat=" + view,
	        type: 'POST'
		}).done(function (data) {
			//$("#test, .all-songs, .pagination-wrapper, .dropdown").remove();
			//$("#cat-name").text(sortby);
			$("#dynamic-content").html(data).hide().fadeIn("fast");
		});
	});
    
    $('.cat-click').click(function (event) {
        mixpanel.track("ST_categoryFilter",{"category": $(this).children("a").find("span").text()});
     });
    
    $('.st-add-click').click(function (event) {
       
        var res = $(this).attr("data-clickinfo").split(",");
        mixpanel.track("ST_addSong",{"songName": res[0], "songId": res[1], "category": res[2] });
     });
    
    //sheets
    
        $('.beginner-trigger').click(function (event) {
            var url = $(this).attr('href');
            event.preventDefault();
         	$.ajax({ url: "/sheet-music/ajax/easy-version-clicked", headers: {'X-CSRF-TOKEN': token},
		      type: 'GET'
		    }).done(function (data) {
                location.href = url;
            });
        
        });
      
    
    	$('#form-contact').submit(function (event) {
            
            $('.error-container').empty();
            var data = $(this).serialize(), formElement;
            event.preventDefault();
            
            $(this).find('input,select,textarea').each(function() {
               if (!$(this).val()) {
                   formElement = this;
                   $(formElement).focus().css('border', '1px solid black');
                   setTimeout(function () {  $(formElement).animate({borderWidth: "0px"},"slow"); }, 2000);
                   $('#form-contact').find('.error-container').html('<div class="alert alert-danger">All field are required.</div>');
                   return false;
               }
              
            });
            
            var test =$('textarea').val(); 

            if(test.indexOf("http://")>-1 || test.indexOf("https://")>-1 ){

                if(test.indexOf("onlinepianist.com") < 0){
                    $('#form-contact').find('.error-container').html('<div class="alert alert-danger">Links are not allowed, unless they are from OnlinePianist.com</div>'); 
                }       

            }
            
            if (!$('.error-container').text()) {
                this.submit(); 
            }
            
        });
    

    
    
     if ($('.trial-pr-event').text() > 0)
        mixpanel.track("PP_TrialToPremium ",{"purchaseValue": $('.trial-pr-event').text() });
    

});